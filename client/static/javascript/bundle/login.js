(()=>{"use strict";const e={setClass(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let e of t)this.classList.add(e);return this},setId(e){return this.id=e,this},setText(e){return this.innerText=e,this},setHTML(e){return this.innerHTML=e,this}};function t(e,t){let n=document.createElement(e,t);for(let e in t.attributes)n.setAttribute(e,t.attributes[e]);for(let e of t.classes)n.classList.add(e);return t.id&&(n.id=t.id),n}var n,i,a,s,o,l,r,c;async function d(e){let t=e.actions;Array.isArray(t)||(t=[e]);for(let e of t)"collect"===e.action?p(e):"register-passkey"===e.action?h(e):"authenticate-passkey"===e.action?y(e):"init-conditional-ui"===e.action&&f()}async function u(e){fetch("/api/login/return",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o,...e})}).then((async e=>{let t=await e.json();t.done||d(t.value)}))}async function p(e){if(n.innerText=e.message,i.innerText=e.header,s.innerHTML="","email"===e.type){let e=t("input",{attributes:{type:"email",placeholder:"Email",required:!0,autocomplete:"email webauthn"},classes:[],id:""});s.appendChild(e);let n=async t=>{t.preventDefault(),u({value:e.value}),a.removeEventListener("submit",n)};a.addEventListener("submit",n)}else if("binary"===e.type){let e=t("input",{attributes:{type:"checkbox",required:!0},classes:[],id:""});s.appendChild(e);let n=async t=>{t.preventDefault(),u({value:e.checked}),a.removeEventListener("submit",n)};a.addEventListener("submit",n)}else if("choice"===e.type){for(let n=0;n<e.options.length;n++){let i=t("input",{attributes:{type:"radio",name:"choice",value:n,required:!0},classes:[],id:""});s.appendChild(i);let a=t("label",{attributes:{for:"choice"},classes:[],id:""});a.innerText=e.options[n],s.appendChild(a)}let n=async e=>{e.preventDefault();const t=document.querySelector('input[name="choice"]:checked');u({value:parseInt(t.value)}),a.removeEventListener("submit",n)};a.addEventListener("submit",n)}}async function h(e){const t=await SimpleWebAuthnBrowser.startRegistration(e.WebAuthnOptions),n=await fetch("/api/login/return",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o,attestationResponse:t})});(await n.json()).value.success}async function y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{WebAuthnOptions:null},t=c;e.WebAuthnOptions&&(t=e.WebAuthnOptions);const n=await SimpleWebAuthnBrowser.startAuthentication(t),i=await fetch("/api/login/return",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o,assertionResponse:n})});(await i.json()).value.success}async function f(e){if(r){if("function"!=typeof PublicKeyCredential.isConditionalMediationAvailable||!PublicKeyCredential.isConditionalMediationAvailable())return;console.log(c),SimpleWebAuthnBrowser.startAuthentication(c,!0).then((async e=>{console.log("authentication",e);const t=await fetch("/api/login/return",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o,assertionResponse:e})});(await t.json()).value.success})).catch((async e=>{console.log(e)}))}let n=t("button",{attributes:{},classes:[],id:"usePasskey"});n.innerText="Sign in with a passkey",n.addEventListener("click",(async function e(t){n.removeEventListener("click",e),await y()})),a.appendChild(n)}Object.keys(e).forEach((t=>{Element.prototype[t]=e[t]})),window.addEventListener("load",(e=>{l=window.PublicKeyCredential&&navigator.credentials&&"function"==typeof navigator.credentials.create&&"function"==typeof navigator.credentials.get,r="function"==typeof PublicKeyCredential.isConditionalMediationAvailable&&PublicKeyCredential.isConditionalMediationAvailable(),n=document.getElementById("collection-message"),i=document.getElementById("collection-header"),a=document.getElementById("collection-form"),s=document.getElementById("collection-inputs"),fetch("/api/login/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({supportsWebAuthn:l,supportsConditionalUI:r})}).then((async e=>{let t=await e.json();o=t.id,c=t.value.authenticationOptions,t.done||d(t.value)}))}))})();