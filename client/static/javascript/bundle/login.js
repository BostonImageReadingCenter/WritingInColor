(()=>{"use strict";const e={setClass(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let e of t)this.classList.add(e);return this},setId(e){return this.id=e,this},setText(e){return this.innerText=e,this},setHTML(e){return this.innerHTML=e,this}};function t(e,t){let n=document.createElement(e,t);for(let e in t.attributes)n.setAttribute(e,t.attributes[e]);for(let e of t.classes)n.classList.add(e);return t.id&&(n.id=t.id),n}let n,i,s,a,o;async function r(e){"collect"===e.action?async function(e){if(n.innerText=e.message,i.innerText=e.header,a.innerHTML="","email"===e.type){let e=t("input",{attributes:{type:"email",placeholder:"Email",required:!0},classes:[],id:""});a.appendChild(e);let n=async t=>{t.preventDefault(),c({value:e.value}),s.removeEventListener("submit",n)};s.addEventListener("submit",n)}else if("binary"===e.type){let e=t("input",{attributes:{type:"checkbox",required:!0},classes:[],id:""});a.appendChild(e);let n=async t=>{t.preventDefault(),c({value:e.checked}),s.removeEventListener("submit",n)};s.addEventListener("submit",n)}else if("choice"===e.type){for(let n=0;n<e.options.length;n++){let i=t("input",{attributes:{type:"radio",name:"choice",value:n,required:!0},classes:[],id:""});a.appendChild(i);let s=t("label",{attributes:{for:"choice"},classes:[],id:""});s.innerText=e.options[n],a.appendChild(s)}let n=async e=>{e.preventDefault(),c({value:parseInt(document.querySelector('input[name="choice"]:checked').value)}),s.removeEventListener("submit",n)};s.addEventListener("submit",n)}}(e):"register-passkey"===e.action?async function(e){const t=await SimpleWebAuthnBrowser.startRegistration(e.WebAuthnOptions),n=await fetch("/api/login/return",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o,attestationResponse:t})});(await n.json()).success}(e):"authenticate-passkey"===e.action&&async function(e){console.log(e);const t=await SimpleWebAuthnBrowser.startAuthentication(e.options),n=await fetch("/api/login/return",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o,assertionResponse:t})});(await n.json()).success}(e)}async function c(e){fetch("/api/login/return",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:o,...e})}).then((async e=>{r(await e.json())}))}Object.keys(e).forEach((t=>{Element.prototype[t]=e[t]})),window.addEventListener("load",(e=>{const t=window.PublicKeyCredential&&navigator.credentials&&"function"==typeof navigator.credentials.create&&"function"==typeof navigator.credentials.get;n=document.getElementById("collection-message"),i=document.getElementById("collection-header"),s=document.getElementById("collection-form"),a=document.getElementById("collection-inputs"),fetch("/api/login/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({supportsWebAuthn:t})}).then((async e=>{let t=await e.json();o=t.id,r(t)}))}))})();